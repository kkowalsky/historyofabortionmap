function initialize(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],setMap(),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0]),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"})}function setMap(){function e(e,t,a,n,s,i,l,c,d,u){function p(e,r,t){for(var o=c.objects.states.geometries,a=0;a<r.length;a++)for(var n=r[a],s=n.adm,i=0;i<o.length;i++)if(o[i].properties.postal==s){attrObj={};for(var l in keyArray){var d=keyArray[l],u=n[d];attrObj[d]=u}o[i].properties[t]=attrObj;break}}joinedJson=topojson.feature(c,c.objects.states).features;var f=[t,a,n,s,i,l],h=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"];for(csv in f)p(c,f[csv],h[csv]);for(var y=r.selectAll(".states").data(joinedJson).enter().append("path").attr("class",function(e){return"states "+e.properties.postal}).style("fill",function(e){return choropleth(e,colorize)}).attr("d",function(e){return o(e)}).on("mouseover",highlight).on("mouseout",dehighlight),g=(y.append("desc").text(function(e){return choropleth(e,colorize)}),[]),v=0;v<d.features.length;v++){var b=d.features[v].properties.Count;g.push(Number(b))}for(var m=Math.min.apply(Math,g),A=Math.max.apply(Math,g),x=d3.scale.sqrt().domain([m,A]).range([2,20]),C=[],w=0;w<u.features.length;w++){var k=u.features[w].properties.Count;C.push(Number(k))}var M=Math.min.apply(Math,C),P=Math.max.apply(Math,C),W=d3.scale.sqrt().domain([M,P]).range([2,23]);setChart(),overlay(o,x,W,r,d,u)}var r=d3.select(".map").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","us-map"),t=d3.geo.albersUsa().scale(1e3).translate([mapWidth/2,mapHeight/2]),o=d3.geo.path().projection(t);queue().defer(d3.csv,"data/grades.csv").defer(d3.csv,"data/prohibitedAfter.csv").defer(d3.csv,"data/counseling.csv").defer(d3.csv,"data/waitingPeriod.csv").defer(d3.csv,"data/consent.csv").defer(d3.csv,"data/ultrasound.csv").defer(d3.json,"data/usa.topojson").defer(d3.json,"data/CPCS.geojson").defer(d3.json,"data/AbortionProviders.geojson").await(e),drawMenu(),drawMenuInfo()}function drawMenu(){$(".Overview").click(function(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0]),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"})}),$(".Prohibited").click(function(){expressed=Category[1],yearExpressed=keyArray[1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayProhibited,colorArrayProhibited,"Prohibited At: ",textArray[1]),$(".Prohibited").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Counseling").click(function(){expressed=Category[2],yearExpressed=keyArray[2],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayCounseling,colorArrayCounseling,"Mandated Counseling: ",textArray[2]),$(".Counseling").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Waiting").click(function(){expressed=Category[3],yearExpressed=keyArray[3],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayWaitingPeriod,colorArrayOverview,"Waiting Period: ",textArray[3]),$(".Waiting").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Parental").click(function(){expressed=Category[4],yearExpressed=keyArray[4],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayConsent,colorArrayConsent,"Parental Consent: ",textArray[4]),$(".Parental").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Ultrasound").click(function(){expressed=Category[5],yearExpressed=keyArray[5],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayUltrasound,colorArrayUltrasound,"Mandatory Ultrasound: ",textArray[5]),$(".Ultrasound").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()})}function drawMenuInfo(){var e=d3.select(".sequence-buttons").append("div").attr("class","dropdown").append("select");e.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return e})}function createMenu(e,r,t,o){{var a=[50,105,160,215,270,325];d3.selectAll(".menuBox").remove(),d3.selectAll(".menuInfoBox").remove()}menuBox=d3.select(".menu-inset").append("svg").attr("width",menuWidth).attr("height",menuHeight).attr("class","menuBox");menuBox.append("text").attr("x",12).attr("y",30).attr("class","title").text(t).style("font-size","16px");for(b=0;b<e.length;b++){var n=menuBox.selectAll(".items").data(e).enter().append("rect").attr("class","items").attr("width",50).attr("height",50).attr("x",12);n.data(a).attr("y",function(e){return e}),n.data(r).attr("fill",function(e,t){return r[t]})}var s=menuBox.selectAll(".menuLabels").data(e).enter().append("text").attr("class","menuLabels").attr("x",70).text(function(r,t){for(var o=0;o<e.length;o++)return e[t]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"});s.data(a).attr("y",function(e){return e+30}),menuInfoBox=d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","menuInfoBox").text(o)}function overlay(e,r,t,o,a,n){$(".cpc-section").click(function(){var t=document.getElementById("cpc-centers"),n=document.getElementById("cpc-inset");d3.selectAll(".cpcLocations")[0].length>0?(removeCPC=d3.selectAll(".cpcLocations").remove(),removeCPCInset=d3.selectAll(".cpcCircles").remove(),t.style.backgroundColor="#c8e713",t.style.color="#fff",t.style.border="none",n.style.visibility="hidden"):(cpcPoints(o,a,e,r),createInset(),t.style.backgroundColor="#fff",t.style.borderStyle="solid",t.style.borderColor="#c8e713",t.style.borderWidth="2px",t.style.color="#c8e713",n.style.visibility="visible")}),$(".abortion-section").click(function(){var r=document.getElementById("abortion-centers"),a=document.getElementById("abortion-inset");d3.selectAll(".abortionLocations")[0].length>0?(removeAbortion=d3.selectAll(".abortionLocations").remove(),removeAbortionInset=d3.selectAll(".abortionCircles").remove(),r.style.backgroundColor="#9608cb",r.style.color="#fff",r.style.border="none",a.style.visibility="hidden"):(abortionPoints(o,n,e,t),createInset(),r.style.backgroundColor="#fff",r.style.borderStyle="solid",r.style.borderColor="#9608cb",r.style.borderWidth="2px",r.style.color="#9608cb",a.style.visibility="visible")})}function cpcPoints(e,r,t,o){e.selectAll(".cpcLocations").data(r.features).enter().append("path").attr("class","cpcLocations").attr("d",t.pointRadius(function(e){return o(e.properties.Count)}))}function abortionPoints(e,r,t,o){e.selectAll(".abortionLocations").data(r.features).enter().append("path").attr("class","abortionLocations").attr("d",t.pointRadius(function(e){return o(e.properties.Count)}))}function createInset(){var e=(d3.selectAll(".cpcCircles").remove(),d3.selectAll(".abortionCircles").remove(),[2,11.85,20]),r=[2,16.23,20];cpcMenuBox=d3.select(".cpc-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","cpcmenuBox");cpcMenuBox.selectAll(".cpcCircles").data(e).enter().append("circle").attr("cy",30).attr("cx",function(e,r){return 2*e+40*r+10}).attr("r",function(e){return e}).attr("class","cpcCircles").style({fill:"#c8e713","fill-opacity":"0.5",stroke:"#9fb80f","stroke-width":"0.75px"});abortionMenuBox=d3.select(".abortion-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","abortionMenuBox");abortionMenuBox.selectAll(".abortionCircles").data(r).enter().append("circle").attr("cy",30).attr("cx",function(e,r){return 2*e+40*r+10}).attr("r",function(e){return e}).attr("class","abortionCircles").style({fill:"#9608cb","fill-opacity":"0.5",stroke:"#72069a","stroke-width":"0.75px"})}function colorScale(e){return"gradeData"===expressed?(currentColors=colorArrayOverview,currentArray=arrayOverview):"consentData"===expressed?(currentColors=colorArrayConsent,currentArray=arrayConsent):"prohibitedAfter"===expressed?(currentColors=colorArrayProhibited,currentArray=arrayProhibited):"counseling"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayCounseling):"waitingPeriod"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayWaitingPeriod):"ultrasound"===expressed&&(currentColors=colorArrayUltrasound,currentArray=arrayUltrasound),scale=d3.scale.ordinal().range(currentColors).domain(currentArray),scale(e[yearExpressed])}function choropleth(e){var r=e.properties?e.properties[expressed]:e.feature.properties[expressed];return colorScale(r)}function choroplethChart(e){var r=e.properties?e.properties[expressed]:e.feature.properties[expressed];return colorScale(r)}function setChart(){var e=(d3.selectAll(".chart").remove(),{top:100,right:40,bottom:30,left:200}),r=d3.scale.linear().domain([keyArray[0],keyArray[keyArray.length-1]]).rangeRound([0,window.innerWidth-e.left-e.right]),t=(d3.svg.axis(),d3.select(".graph").append("svg").attr("width",chartWidth+"%").attr("height",chartHeight+"px").attr("class","chart").append("g").attr("transform","translate("+e.left+", "+e.top+")"));for(var o in joinedJson)for(var a=joinedJson[o],n=keyArray[1];n<keyArray[keyArray.length-1];n++){var s=n-1;a.properties[expressed][n]!=a.properties[expressed][s]&&void 0!=a.properties[expressed][n]&&void 0!=a.properties[expressed][s]&&timelineFeatureArray.push({yearChanged:n,newLaw:a.properties[expressed][n],feature:a})}var l=[];for(i=0;i<keyArray.length;i++){var c={year:keyArray[i],count:0};l.push(c)}t.selectAll(".rect").data(timelineFeatureArray).enter().append("rect").attr("class",function(e){return"rect "+e.feature.properties.postal}).attr("width",squareWidth+"px").attr("height",squareHeight+"px").attr("transform",function(e){return"translate("+r(e.yearChanged)+")"}).attr("y",function(e,r){var t;for(r=0;r<l.length;r++)l[r].year==e.yearChanged&&(t=l[r].count*(squareHeight+1),l[r].count-=1);return t}).style("fill",function(){return"#000"}).on("mouseover",highlightChart).on("mouseout",dehighlightChart),t.append("svg").attr("class","axis").attr("width","90%").attr("height","10px")}function updateChart(){}function highlight(e){var r=e.properties?e.properties:e.feature.properties[expressed];d3.selectAll("."+r.postal).style("fill","#00C6FF")}function highlightChart(e){var r=e.feature.properties;d3.selectAll("."+r.postal).style("fill","#00C6FF")}function dehighlight(e){var r=e.properties?e.properties:e.feature.properties[expressed],t=d3.selectAll("."+r.postal),o=t.select("desc").text();t.style("fill",o)}function dehighlightChart(){var e=timelineFeatureArray.feature.properties,r=d3.selectAll("."+e.postal),t=r.select("desc").text();r.style("fill",t)}var mapWidth=850,mapHeight=500,keyArray=["1973","1974","1975","1976","1977","1977","1977","1978","1979","1980","1981","1982","1983","1984","1983","1984","1985","1986","1987","1988","1989","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],Category=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"],expressed,yearExpressed,colorize,scale,currentColors=[],menuWidth=200,menuHeight=420,otherMenuWidth=198,otherMenuHeight=70,menuInfoWidth=400,menuInfoHeight=100,textArray=["Explanation of Overview Henshaw travelled to France near the beginning of World War I, and returned to give speeches in favour of conscription and to raise money for ambulance services there. She particularly spoke to female audiences, some of whom had been granted the right to vote by the Wartime Elections Act of 1917, and hence to vote on the conscription question","Explanation of Prohibited At Born in Yate, Gloucestershire, Rowling was working as a researcher and bilingual secretary for Amnesty International when she conceived the idea for the Harry Potter series on a delayed train from Manchester to London in 1990.","Explanation of Mandated Counseling The university has three campuses: Streatham; St Luke's (both of which are in Exeter); and Tremough in Cornwall. The university is centred in the city of Exeter, Devon, where it is the principal higher education institution.","Explanation of Waiting Period In 2007, Spears's much-publicized personal issues sent her career into hiatus. Her fifth studio album, Blackout, was released later that year, and spawned hits such as Gimme More and Piece of Me. ","Explanation of Parental Consent Mad Men is set in the 1960s, initially at the fictional Sterling Cooper advertising agency on Madison Avenue in New York City, and later at the newly created firm, Sterling Cooper Draper Pryce (later Sterling Cooper & Partners), located nearby in the Time-Life Building, at 1271 Sixth Avenue.","Explanation of Mandatory Ultrasound They have a lot of production meetings during pre-production. The day the script comes in we all meet for a first page turn, and Matt starts telling us how he envisions it. Then there's a tone meeting a few days later where Matt tells us how he envisions it. And then there's a final full crew production meeting where Matt again tells us how he envisions it....","Explanation of CPCS Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.","Explanation of Abortion Providers Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor."],removeCPC,removeAbortion,joinedJson,arrayOverview=["F","D","C","B","A"],arrayProhibited=["12 weeks","20 weeks","22 weeks","24 weeks","3rd trimester","Viability"],arrayCounseling=["Yes","No"],arrayWaitingPeriod=["72 hours","48 hours","24 hours","18 hours","None"],arrayConsent=["consent","notice","none"],arrayUltrasound=["Must be performed, offer to view","x","o","none"],colorArrayOverview=["#252525","#636363","#969696","#cccccc","#e6e6e6"],colorArrayProhibited=["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#e6e6e6"],colorArrayCounseling=["#252525","#e6e6e6"],colorArrayConsent=["#252525","#969696","#e6e6e6"],colorArrayUltrasound=["#252525","#636363","#969696","#e6e6e6"],currentColors=[],currentArray=[],chartHeight=200,chartWidth=100,squareWidth=20,squareHeight=20,timelineFeatureArray=[];window.onload=initialize(),$(function(){$(".nav li a").on("click",function(){var e=$(this).parent("li"),r=e.parent("ul");e.hasClass("active")||(r.find("li.active").removeClass("active"),e.addClass("active"))})});