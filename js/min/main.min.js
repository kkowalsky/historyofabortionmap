function initialize(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],setMap(),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0],linkArray[0]),createInset(),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"})}function setMap(){function e(e,t,a,n,s,l,c,i,d,u){function f(e,r,t){for(var o=i.objects.states.geometries,a=0;a<r.length;a++)for(var n=r[a],s=n.adm,l=0;l<o.length;l++)if(o[l].properties.postal==s){attrObj={};for(var c in keyArray){var d=keyArray[c],u=n[d];attrObj[d]=u}o[l].properties[t]=attrObj;break}}joinedJson=topojson.feature(i,i.objects.states).features,colorize=colorScale(joinedJson);var h=[t,a,n,s,l,c],p=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"];for(csv in h)f(i,h[csv],p[csv]);for(var y=r.selectAll(".states").data(joinedJson).enter().append("path").attr("class",function(e){return"states "+e.properties.postal}).style("fill",function(e){return choropleth(e,colorize)}).attr("d",function(e){return o(e)}).on("mouseover",highlight).on("mouseout",dehighlight),g=(y.append("desc").text(function(e){return choropleth(e,colorize)}),[]),v=0;v<d.features.length;v++){var b=d.features[v].properties.Count;g.push(Number(b))}for(var m=Math.min.apply(Math,g),A=Math.max.apply(Math,g),x=d3.scale.sqrt().domain([m,A]).range([2,20]),C=[],w=0;w<u.features.length;w++){var k=u.features[w].properties.Count;C.push(Number(k))}var M=Math.min.apply(Math,C),P=Math.max.apply(Math,C),B=d3.scale.sqrt().domain([M,P]).range([2,23]);removeChart(),setChart(),overlay(o,x,B,r,d,u),drawMenuInfo(colorize,yearExpressed)}var r=d3.select(".map").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","us-map"),t=d3.geo.albersUsa().scale(900).translate([mapWidth/2,mapHeight/2]),o=d3.geo.path().projection(t);queue().defer(d3.csv,"data/grades.csv").defer(d3.csv,"data/prohibitedAfter.csv").defer(d3.csv,"data/counseling.csv").defer(d3.csv,"data/waitingPeriod.csv").defer(d3.csv,"data/consent.csv").defer(d3.csv,"data/ultrasound.csv").defer(d3.json,"data/usa.topojson").defer(d3.json,"data/CPCS.geojson").defer(d3.json,"data/AbortionProviders.geojson").await(e),drawMenu()}function drawMenu(){$(".Overview").click(function(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0],linkArray[0]),d3.selectAll(".sequence-buttons").style(""),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.selectAll(".chart").remove(),d3.selectAll(".chartRect").remove()}),$(".Prohibited").click(function(){expressed=Category[1],yearExpressed=keyArray[1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayProhibited,colorArrayProhibited,"Prohibited At: ",textArray[1],linkArray[1]),$(".Prohibited").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.select(".chart").remove(),d3.selectAll(".chartRect").remove();setChart()}),$(".Counseling").click(function(){expressed=Category[2],yearExpressed=keyArray[2],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayCounseling,colorArrayCounseling,"Mandated Counseling: ",textArray[2],linkArray[2]),$(".Counseling").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.select(".chart").remove(),d3.selectAll(".chartRect").remove();setChart()}),$(".Waiting").click(function(){expressed=Category[3],yearExpressed=keyArray[3],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayWaitingPeriod,colorArrayOverview,"Waiting Period: ",textArray[3],linkArray[3]),$(".Waiting").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.select(".chart").remove(),d3.selectAll(".chartRect").remove();setChart()}),$(".Parental").click(function(){expressed=Category[4],yearExpressed=keyArray[4],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayConsent,colorArrayConsent,"Parental Consent: ",textArray[4],linkArray[4]),$(".Parental").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.select(".chart").remove(),d3.selectAll(".chartRect").remove();setChart()}),$(".Ultrasound").click(function(){expressed=Category[5],yearExpressed=keyArray[5],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)}),createMenu(arrayUltrasound,colorArrayUltrasound,"Mandatory Ultrasound: ",textArray[5],linkArray[5]),$(".Ultrasound").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"});d3.select(".chart").remove(),d3.selectAll(".chartRect").remove();setChart()})}function animateMap(){}function drawMenuInfo(e,r){var r=d3.select(".menuInfoBox").append("text").attr("x",12).attr("y",30).attr("class","yearExpressed menuInfoBox").text(r).style({"font-size":"24px","float":"right","padding-right":"50px"}),t=d3.select(".sequence-buttons").append("div").attr("class","dropdown").append("select").on("change",function(){changeAttribute(this.value,e)});t.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return e})}function changeAttribute(e,r){for(x=0;x<keyArray.length;x++)e==keyArray[x]&&(yearExpressed=keyArray[x]);d3.selectAll(".states").style("fill",function(e){return choropleth(e,r)}).select("desc").text(function(e){return choropleth(e,r)})}function createMenu(e,r,t,o,a){{var n=[50,105,160,215,270,325];d3.selectAll(".menuBox").remove(),d3.selectAll(".menuInfoBox").remove()}menuBox=d3.select(".menu-inset").append("svg").attr("width",menuWidth).attr("height",menuHeight).attr("class","menuBox");menuBox.append("text").attr("x",12).attr("y",30).attr("class","title").text(t).style("font-size","16px");for(b=0;b<e.length;b++){var s=menuBox.selectAll(".items").data(e).enter().append("rect").attr("class","items").attr("width",50).attr("height",50).attr("x",12);s.data(n).attr("y",function(e){return e}),s.data(r).attr("fill",function(e,t){return r[t]})}var l=menuBox.selectAll(".menuLabels").data(e).enter().append("text").attr("class","menuLabels").attr("x",70).text(function(r,t){for(var o=0;o<e.length;o++)return e[t]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"});l.data(n).attr("y",function(e){return e+30}),menuInfoBox=d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","menuInfoBox").html(o+a)}function overlay(e,r,t,o,a,n){$(".cpc-section").click(function(){var t=document.getElementById("cpc-centers"),n=document.getElementById("cpc-inset");d3.selectAll(".cpcLocations")[0].length>0?(removeCPC=d3.selectAll(".cpcLocations").remove(),removeCPCInfo=d3.selectAll(".cpcMenuInfoBox").remove(),t.style.backgroundColor="#c8e713",t.style.color="#fff",t.style.border="none",n.style.visibility="hidden"):(cpcPoints(o,a,e,r),t.style.backgroundColor="#fff",t.style.borderStyle="solid",t.style.borderColor="#c8e713",t.style.borderWidth="2px",t.style.color="#c8e713",n.style.visibility="visible")}),$(".abortion-section").click(function(){var r=document.getElementById("abortion-centers"),a=document.getElementById("abortion-inset");d3.selectAll(".abortionLocations")[0].length>0?(removeAbortion=d3.selectAll(".abortionLocations").remove(),removeAbortionInfo=d3.selectAll(".abortionMenuInfoBox").remove(),r.style.backgroundColor="#9608cb",r.style.color="#fff",r.style.border="none",a.style.visibility="hidden"):(abortionPoints(o,n,e,t),r.style.backgroundColor="#fff",r.style.borderStyle="solid",r.style.borderColor="#9608cb",r.style.borderWidth="2px",r.style.color="#9608cb",a.style.visibility="visible")})}function cpcPoints(e,r,t,o){e.selectAll(".cpcLocations").data(r.features).enter().append("path").attr("class","cpcLocations").attr("d",t.pointRadius(function(e){return o(e.properties.Count)}));d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","cpcMenuInfoBox").text(textArray[6])}function abortionPoints(e,r,t,o){e.selectAll(".abortionLocations").data(r.features).enter().append("path").attr("class","abortionLocations").attr("d",t.pointRadius(function(e){return o(e.properties.Count)}));d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","abortionMenuInfoBox").text(textArray[7])}function createInset(){var e=(d3.selectAll(".cpcCircles").remove(),d3.selectAll(".abortionCircles").remove(),[2,11.85,20]),r=[1,4,8],t=[2,16.23,20],o=[1,6,11];cpcMenuBox=d3.select(".cpc-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","cpcmenuBox");var a=(cpcMenuBox.selectAll(".cpcCircles").data(e).enter().append("circle").attr("cy",30).attr("cx",function(e,r){return 2*e+50*r+10}).attr("r",function(e){return e}).attr("class","cpcCircles").style({fill:"#c8e713","fill-opacity":"0.5",stroke:"#9fb80f","stroke-width":"0.75px"}),cpcMenuBox.selectAll(".cpcOverlayLabels").data(r).enter().append("text").attr("class","cpcOverlayLabels").attr("y",35).text(function(e,t){for(var o=0;o<r.length;o++)return r[t]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"}));a.data(e).attr("x",function(e,r){return 3*e+50*r+15}),abortionMenuBox=d3.select(".abortion-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","abortionMenuBox");var n=(abortionMenuBox.selectAll(".abortionCircles").data(t).enter().append("circle").attr("cy",30).attr("cx",function(e,r){return 2*e+50*r+10}).attr("r",function(e){return e}).attr("class","abortionCircles").style({fill:"#9608cb","fill-opacity":"0.5",stroke:"#72069a","stroke-width":"0.75px"}),abortionMenuBox.selectAll(".abortionOverlayLabels").data(o).enter().append("text").attr("class","abortionOverlayLabels").attr("y",35).text(function(e,r){for(var t=0;t<o.length;t++)return o[r]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"}));n.data(t).attr("x",function(e,r){return 3*e+50*r+15})}function colorScale(e){return"gradeData"===expressed?(currentColors=colorArrayOverview,currentArray=arrayOverview):"consentData"===expressed?(currentColors=colorArrayConsent,currentArray=arrayConsent):"prohibitedAfter"===expressed?(currentColors=colorArrayProhibited,currentArray=arrayProhibited):"counseling"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayCounseling):"waitingPeriod"===expressed?(currentColors=colorArrayOverview,currentArray=arrayWaitingPeriod):"ultrasound"===expressed&&(currentColors=colorArrayUltrasound,currentArray=arrayUltrasound),scale=d3.scale.ordinal().range(currentColors).domain(currentArray),scale(e[yearExpressed])}function colorScaleChart(e){return"gradeData"===expressed?(currentColors=colorArrayOverview,currentArray=arrayOverview):"consentData"===expressed?(currentColors=colorArrayConsent,currentArray=arrayConsent):"prohibitedAfter"===expressed?(currentColors=colorArrayProhibited,currentArray=arrayProhibited):"counseling"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayCounseling):"waitingPeriod"===expressed?(currentColors=colorArrayOverview,currentArray=arrayWaitingPeriod):"ultrasound"===expressed&&(currentColors=colorArrayUltrasound,currentArray=arrayUltrasound),scale=d3.scale.ordinal().range(currentColors).domain(currentArray),scale(e)}function choropleth(e){var r=e.properties?e.properties[expressed]:e;return colorScale(r)}function choroplethChart(e){return colorScaleChart(e)}function setChart(){var e=[];colorizeChart=colorScaleChart(e);var r=(d3.svg.axis(),d3.select(".graph").append("svg").attr("width",chartWidth+"%").attr("height",chartHeight+"px").attr("class","chart").append("g").attr("transform","translate("+margin.left+", "+margin.top+")"));for(var t in joinedJson)for(var o=joinedJson[t],a=1;a<=keyArray.length-1;a++){var n=a-1;o.properties[expressed][keyArray[a]]!=o.properties[expressed][keyArray[n]]&&e.push({yearChanged:Number(keyArray[a]),newLaw:o.properties[expressed][keyArray[a]],feature:o})}console.log(e);var s=[];for(key in keyArray){var l=1;for(i=0;i<e.length;i++)e[i].yearChanged==keyArray[key]&&(s.push({year:Number(keyArray[key]),count:l}),l=l++)}console.log(s),chartRect=r.selectAll(".chartRect").data(e).enter().append("rect").attr("class",function(e){return"chartRect "+e.feature.properties.postal}).attr("width",squareWidth+"px").attr("height",squareHeight+"px");{var c=d3.scale.linear().domain([keyArray[0],keyArray[keyArray.length-1]]).rangeRound([0,window.innerWidth-margin.left-margin.right]);chartRect.attr("transform",function(e){return"translate("+c(e.yearChanged)+")"}).attr("y",function(e,r){var t;for(r=0;r<s.length;r++)s[r].year==e.yearChanged&&(t=s[r].count*(squareHeight+1),s[r].count-=1);return t}).style("fill",function(e){return choroplethChart(e.newLaw,colorizeChart)}).on("mouseover",highlightChart).on("mouseout",dehighlight),r.append("svg").attr("class","axis").attr("width","90%").attr("height","10px")}}function removeChart(){$(".chartRect").length>0&&(removeChart=d3.selectAll(".chart").remove())}function highlight(e,r){var t=e.properties?e.properties:r.feature.properties;d3.selectAll("."+t.postal).style("fill","#00C6FF");{var o=t.name;d3.select("body").append("div").attr("class","infoLabel").attr("id",t.postal+"label").html(o)}}function highlightChart(e){var r=e.feature.properties;d3.selectAll("."+r.postal).style("fill","#00C6FF")}function dehighlight(e){var r=e.properties?e.properties:e.feature.properties[expressed],t=d3.selectAll("."+r.postal),o=t.select("desc").text();t.style("fill",o);d3.select("#"+r.postal+"label").remove()}function dehighlightChart(){var e=timelineFeatureArray.feature.properties,r=d3.selectAll("."+e.postal),t=r.select("desc").text();r.style("fill",t)}var mapWidth=750,mapHeight=400,keyArray=["1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],Category=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"],expressed,yearExpressed,colorize,scale,currentColors=[],menuWidth=200,menuHeight=420,otherMenuWidth=198,otherMenuHeight=70,menuInfoWidth=400,menuInfoHeight=100,textArray=["The report card grade, created by NARAL, given to each state based on their policies regarding a woman's choice and access to abortions.","States with laws that require biased-counseling to women seeking abortion services.","States with laws that subject women seeking abortion services to biased-counseling requirements.","States where a woman must wait a designated period of time after counseling before having an abortion.","States with laws restricting young women's access to abortion services by mandating parental consent.","States where an ultrasound either must be performed, offered, or advised prior to an abortion.","Crisis Pregnancy Centers are facilities that provide women with services and counseling to pregnant women, but appose abortion. CPC's are known for intimidating women about the dangers of abortion with inaccurate information.","Abortion Providers are facilites that help with family planning, reproductive health, and educate people about safe sex. They do not promote abortion, but help women in need of one"],linkArray=["<a href = '#jumpoverview'> Read More</a>","<a href = '#jumpprohibted'> Read More</a>","<a href = '#jumpconsent'> Read More</a>","<a href = '#jumpcounseling'> Read More</a>","<a href = '#jumpultra'> Read More</a>","<a href = '#jumpcpc'> Read More</a>"],removeCPC,removeAbortion,joinedJson,arrayOverview=["F","D","C","B","A"],arrayProhibited=["12 weeks","20 weeks","22 weeks","24 weeks","3rd trimester","Viability"],arrayCounseling=["Yes","No"],arrayWaitingPeriod=["72 hours","48 hours","24 hours","18 hours","None"],arrayConsent=["consent","notice","none"],arrayUltrasound=["Must be performed","Must be offered","Must be informed","none"],colorArrayOverview=["#252525","#636363","#969696","#cccccc","#e6e6e6"],colorArrayProhibited=["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#e6e6e6"],colorArrayCounseling=["#252525","#e6e6e6"],colorArrayConsent=["#252525","#969696","#e6e6e6"],colorArrayUltrasound=["#252525","#636363","#969696","#e6e6e6"],currentColors=[],currentArray=[],colorizeChart,removeChart,chartHeight=200,chartWidth=100,squareWidth=20,squareHeight=20,chartRect,margin={top:100,right:40,bottom:30,left:150};window.onload=initialize(),$(function(){$(".nav li a").on("click",function(){var e=$(this).parent("li"),r=e.parent("ul");e.hasClass("active")||(r.find("li.active").removeClass("active"),e.addClass("active"))})});