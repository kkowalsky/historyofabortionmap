function initialize(){setMap()}function setMap(){function e(e,r,o,n,s,i){function c(e,t,r){for(var a=n.objects.states.geometries,o=0;o<t.length;o++)for(var s=t[o],i=s.adm,c=0;c<a.length;c++)if(a[c].properties.postal==i){attrObj={};for(var l in yearsArray){var d=yearsArray[l],p=s[d];attrObj[d]=p}a[c].properties[r]=attrObj;break}}joinedJson=topojson.feature(n,n.objects.states).features;var l=[r,o],d=["ConsentData","gradeData"];for(csv in l)c(n,l[csv],d[csv]);for(var p=(t.selectAll(".states").data(joinedJson).enter().append("path").attr("class",function(e){return"states "+e.properties.postal}).attr("d",function(e){return a(e)}).style("fill",function(e){return choropleth(e,colorScale)}),[]),u=0;u<s.features.length;u++){var f=s.features[u].properties.Count;p.push(Number(f))}for(var h=Math.min.apply(Math,p),g=Math.max.apply(Math,p),v=d3.scale.sqrt().domain([h,g]).range([2,15]),y=[],m=0;m<i.features.length;m++){var C=i.features[m].properties.Count;y.push(Number(C))}Math.min.apply(Math,y),Math.max.apply(Math,y);overlay(a,v,t,s,i),setChart()}var t=d3.select(".map").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","us-map"),r=d3.geo.albersUsa().scale(1e3).translate([mapWidth/2,mapHeight/2]),a=d3.geo.path().projection(r);queue().defer(d3.csv,"data/consent.csv").defer(d3.csv,"data/Grades.csv").defer(d3.json,"data/usa.topojson").defer(d3.json,"data/CPCS.geojson").defer(d3.json,"data/AbortionProviders.geojson").await(e)}function drawMenu(){}function cpcPoints(e,t,r,a){e.selectAll(".cpcLocations").data(t.features).enter().append("path").attr("class","cpcLocations").attr("d",r.pointRadius(function(e){return a(e.properties.Count)}))}function abortionPoints(e,t,r,a){e.selectAll(".abortionLocations").data(t.features).enter().append("path").attr("class","abortionLocations").attr("d",r.pointRadius(function(e){return a(e.properties.Count)}))}function overlay(e,t,r,a,o){$(".cpc-section").click(function(){d3.selectAll(".cpcLocations")[0].length>0?removeCPC=d3.selectAll(".cpcLocations").remove():cpcPoints(r,a,e,t)}),$(".abortion-section").click(function(){d3.selectAll(".abortionLocations")[0].length>0?removeAbortion=d3.selectAll(".abortionLocations").remove():abortionPoints(r,o,e,t)})}function changeAttribute(){}function colorScale(e){"gradeData"===expressed?(console.log(e),scale=d3.scale.ordinal(arrayGrades),currentColors=colorArrayGrade):"consentData"===expressed&&(scale=d3.scale.ordinal(),currentColors=colorArrayConsent),scale=scale.range(currentColors)}function choropleth(e){var t=e.properties?e.properties[expressed]:e[expressed];return"no data"===t?"#ccc":"no data"!=t?colorScale(t[yearExpressed]):"#ccc"}function setChart(){{var e={top:10,right:40,bottom:30,left:40},t=(d3.scale.linear().domain(timelineArray).rangeRound([0,chartWidth-e.left-e.right]),d3.svg.axis(),d3.select(".graph").append("svg").attr("width",chartWidth+"%").attr("height",chartHeight+"px").attr("class","chart").append("g").attr("transform","translate("+e.left+", "+e.top+")"));t.selectAll(".rect").data(joinedJson).enter().append("rect").attr("class",function(e){return"rect "+e.properties.postal}).attr("width","10px").attr("height","10px")}console.log(joinedJson)}function updateChart(){}var mapWidth=850,mapHeight=600,yearsArray=["grade","Pre-1973","1973","1974","1975","1976","1977","1977","1977","1978","1979","1980","1981","1982","1983","1984","1983","1984","1985","1986","1987","1988","1989","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],Category=["gradeData","ConsentData"],expressed=Category[0],yearExpressed=yearsArray[0],removeCPC,removeAbortion,joinedJson,colorize,scale,currentColors=[];window.onload=initialize(),colorArrayGrade=["#252525","#636363","#969696","#cccccc","#f7f7f7"],colorArrayProhibited=["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],colorArrayCounseling=["#252525","#f7f7f7"],colorArrayConsent=["#252525","#969696","#f7f7f7"],colorArrayUltrasound=["#252525","#636363","#969696","#f7f7f7"],arrayGrades=["F","D","C","B","A"],arrayProhibited=["12 weeks","20 weeks","22 weeks","24 weeks","3rd trimester","Viability"],arrayCounseling=["Yes","No"],arrayWaitingPeriod=["72 hours","48 hours","24 hours","18 hours","None"],arrayConsent=["Consent","Notice","None"],arrayUltrasound=["Must be performed, offer to view","Must be performed","Must be offered","None"],$(function(){$(".nav li a").on("click",function(){var e=$(this).parent("li"),t=e.parent("ul");e.hasClass("active")||(t.find("li.active").removeClass("active"),e.addClass("active"))})});