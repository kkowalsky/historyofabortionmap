function initialize(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],setMap(),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0]),createInset(),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"})}function setMap(){function e(e,r,a,n,s,i,l,c,d,u){function f(e,t,r){for(var o=c.objects.states.geometries,a=0;a<t.length;a++)for(var n=t[a],s=n.adm,i=0;i<o.length;i++)if(o[i].properties.postal==s){attrObj={};for(var l in keyArray){var d=keyArray[l],u=n[d];attrObj[d]=u}o[i].properties[r]=attrObj;break}}joinedJson=topojson.feature(c,c.objects.states).features;var p=[r,a,n,s,i,l],h=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"];for(csv in p)f(c,p[csv],h[csv]);for(var y=t.selectAll(".states").data(joinedJson).enter().append("path").attr("class",function(e){return"states "+e.properties.postal}).style("fill",function(e){return choropleth(e,colorize)}).attr("d",function(e){return o(e)}).on("mouseover",highlight).on("mouseout",dehighlight),g=(y.append("desc").text(function(e){return choropleth(e,colorize)}),[]),b=0;b<d.features.length;b++){var v=d.features[b].properties.Count;g.push(Number(v))}for(var A=Math.min.apply(Math,g),x=Math.max.apply(Math,g),m=d3.scale.sqrt().domain([A,x]).range([2,20]),C=[],w=0;w<u.features.length;w++){var k=u.features[w].properties.Count;C.push(Number(k))}var M=Math.min.apply(Math,C),P=Math.max.apply(Math,C),B=d3.scale.sqrt().domain([M,P]).range([2,23]);setChart(),overlay(o,m,B,t,d,u)}var t=d3.select(".map").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","us-map"),r=d3.geo.albersUsa().scale(1e3).translate([mapWidth/2,mapHeight/2]),o=d3.geo.path().projection(r);queue().defer(d3.csv,"data/grades.csv").defer(d3.csv,"data/prohibitedAfter.csv").defer(d3.csv,"data/counseling.csv").defer(d3.csv,"data/waitingPeriod.csv").defer(d3.csv,"data/consent.csv").defer(d3.csv,"data/ultrasound.csv").defer(d3.json,"data/usa.topojson").defer(d3.json,"data/CPCS.geojson").defer(d3.json,"data/AbortionProviders.geojson").await(e),drawMenu(),drawMenuInfo(colorize)}function drawMenu(){$(".Overview").click(function(){expressed=Category[0],yearExpressed=keyArray[keyArray.length-1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayOverview,colorArrayOverview,"Grading Scale: ",textArray[0]),$(".Overview").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"})}),$(".Prohibited").click(function(){expressed=Category[1],yearExpressed=keyArray[1],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayProhibited,colorArrayProhibited,"Prohibited At: ",textArray[1]),$(".Prohibited").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Counseling").click(function(){expressed=Category[2],yearExpressed=keyArray[2],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayCounseling,colorArrayCounseling,"Mandated Counseling: ",textArray[2]),$(".Counseling").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Waiting").click(function(){expressed=Category[3],yearExpressed=keyArray[3],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayWaitingPeriod,colorArrayOverview,"Waiting Period: ",textArray[3]),$(".Waiting").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Parental").click(function(){expressed=Category[4],yearExpressed=keyArray[4],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayConsent,colorArrayConsent,"Parental Consent: ",textArray[4]),$(".Parental").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()}),$(".Ultrasound").click(function(){expressed=Category[5],yearExpressed=keyArray[5],d3.selectAll(".menu-options div").style({"background-color":"#00c6ff",color:"#fff","border-style":"none"}),d3.selectAll(".states").style("fill",function(e){return choropleth(e,colorize)}),createMenu(arrayUltrasound,colorArrayUltrasound,"Mandatory Ultrasound: ",textArray[5]),$(".Ultrasound").css({"background-color":"#fff","border-style":"solid","border-color":"#00c6ff","border-width":"2px",color:"#00c6ff"}),setChart()})}function animateMap(){}function drawMenuInfo(e){var t=d3.select(".sequence-buttons").append("div").attr("class","dropdown").append("select").on("change",function(){changeAttribute(this.value,e)});t.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return e})}function changeAttribute(){d3.selectAll(".states").style("fill",function(e){return choropleth(e,choropleth)}),console.log("hello world")}function createMenu(e,t,r,o){{var a=[50,105,160,215,270,325];d3.selectAll(".menuBox").remove(),d3.selectAll(".menuInfoBox").remove()}menuBox=d3.select(".menu-inset").append("svg").attr("width",menuWidth).attr("height",menuHeight).attr("class","menuBox");menuBox.append("text").attr("x",12).attr("y",30).attr("class","title").text(r).style("font-size","16px");for(b=0;b<e.length;b++){var n=menuBox.selectAll(".items").data(e).enter().append("rect").attr("class","items").attr("width",50).attr("height",50).attr("x",12);n.data(a).attr("y",function(e){return e}),n.data(t).attr("fill",function(e,r){return t[r]})}var s=menuBox.selectAll(".menuLabels").data(e).enter().append("text").attr("class","menuLabels").attr("x",70).text(function(t,r){for(var o=0;o<e.length;o++)return e[r]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"});s.data(a).attr("y",function(e){return e+30}),menuInfoBox=d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","menuInfoBox").text(o)}function overlay(e,t,r,o,a,n){$(".cpc-section").click(function(){var r=document.getElementById("cpc-centers"),n=document.getElementById("cpc-inset");d3.selectAll(".cpcLocations")[0].length>0?(removeCPC=d3.selectAll(".cpcLocations").remove(),removeCPCInfo=d3.selectAll(".cpcMenuInfoBox").remove(),r.style.backgroundColor="#c8e713",r.style.color="#fff",r.style.border="none",n.style.visibility="hidden"):(cpcPoints(o,a,e,t),r.style.backgroundColor="#fff",r.style.borderStyle="solid",r.style.borderColor="#c8e713",r.style.borderWidth="2px",r.style.color="#c8e713",n.style.visibility="visible")}),$(".abortion-section").click(function(){var t=document.getElementById("abortion-centers"),a=document.getElementById("abortion-inset");d3.selectAll(".abortionLocations")[0].length>0?(removeAbortion=d3.selectAll(".abortionLocations").remove(),removeAbortionInfo=d3.selectAll(".abortionMenuInfoBox").remove(),t.style.backgroundColor="#9608cb",t.style.color="#fff",t.style.border="none",a.style.visibility="hidden"):(abortionPoints(o,n,e,r),t.style.backgroundColor="#fff",t.style.borderStyle="solid",t.style.borderColor="#9608cb",t.style.borderWidth="2px",t.style.color="#9608cb",a.style.visibility="visible")})}function cpcPoints(e,t,r,o){e.selectAll(".cpcLocations").data(t.features).enter().append("path").attr("class","cpcLocations").attr("d",r.pointRadius(function(e){return o(e.properties.Count)}));d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","cpcMenuInfoBox").text(textArray[6])}function abortionPoints(e,t,r,o){e.selectAll(".abortionLocations").data(t.features).enter().append("path").attr("class","abortionLocations").attr("d",r.pointRadius(function(e){return o(e.properties.Count)}));d3.select(".menu-info").append("div").attr("width",menuInfoWidth).attr("height",menuInfoHeight).attr("class","abortionMenuInfoBox").text(textArray[7])}function createInset(){var e=(d3.selectAll(".cpcCircles").remove(),d3.selectAll(".abortionCircles").remove(),[2,11.85,20]),t=[1,4,8],r=[2,16.23,20],o=[1,6,11];cpcMenuBox=d3.select(".cpc-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","cpcmenuBox");var a=(cpcMenuBox.selectAll(".cpcCircles").data(e).enter().append("circle").attr("cy",30).attr("cx",function(e,t){return 2*e+50*t+10}).attr("r",function(e){return e}).attr("class","cpcCircles").style({fill:"#c8e713","fill-opacity":"0.5",stroke:"#9fb80f","stroke-width":"0.75px"}),cpcMenuBox.selectAll(".cpcOverlayLabels").data(t).enter().append("text").attr("class","cpcOverlayLabels").attr("y",35).text(function(e,r){for(var o=0;o<t.length;o++)return t[r]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"}));a.data(e).attr("x",function(e,t){return 3*e+50*t+15}),abortionMenuBox=d3.select(".abortion-inset").append("svg").attr("width",otherMenuWidth).attr("height",otherMenuHeight).attr("class","abortionMenuBox");var n=(abortionMenuBox.selectAll(".abortionCircles").data(r).enter().append("circle").attr("cy",30).attr("cx",function(e,t){return 2*e+50*t+10}).attr("r",function(e){return e}).attr("class","abortionCircles").style({fill:"#9608cb","fill-opacity":"0.5",stroke:"#72069a","stroke-width":"0.75px"}),abortionMenuBox.selectAll(".abortionOverlayLabels").data(o).enter().append("text").attr("class","abortionOverlayLabels").attr("y",35).text(function(e,t){for(var r=0;r<o.length;r++)return o[t]}).style({"font-size":"14px","font-family":"Open Sans, sans-serif"}));n.data(r).attr("x",function(e,t){return 3*e+50*t+15})}function colorScale(e){return"gradeData"===expressed?(currentColors=colorArrayOverview,currentArray=arrayOverview):"consentData"===expressed?(currentColors=colorArrayConsent,currentArray=arrayConsent):"prohibitedAfter"===expressed?(currentColors=colorArrayProhibited,currentArray=arrayProhibited):"counseling"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayCounseling):"waitingPeriod"===expressed?(currentColors=colorArrayCounseling,currentArray=arrayWaitingPeriod):"ultrasound"===expressed&&(currentColors=colorArrayUltrasound,currentArray=arrayUltrasound),scale=d3.scale.ordinal().range(currentColors).domain(currentArray),scale(e[yearExpressed])}function choropleth(e){var t=e.properties?e.properties[expressed]:e.feature.properties[expressed];return colorScale(t)}function choroplethChart(e){var t=e.properties?e.properties[expressed]:e.feature.properties[expressed];return colorScale(t)}function setChart(){var e=(d3.selectAll(".chart").remove(),{top:100,right:40,bottom:30,left:80}),t=d3.scale.linear().domain([keyArray[0],keyArray[keyArray.length-1]]).rangeRound([0,window.innerWidth-e.left-e.right]),r=(d3.svg.axis(),d3.select(".graph").append("svg").attr("width",chartWidth+"%").attr("height",chartHeight+"px").attr("class","chart").append("g").attr("transform","translate("+e.left+", "+e.top+")"));for(var o in joinedJson)for(var a=joinedJson[o],n=keyArray[1];n<keyArray[keyArray.length-1];n++){var s=n-1;a.properties[expressed][n]!=a.properties[expressed][s]&&void 0!=a.properties[expressed][n]&&void 0!=a.properties[expressed][s]&&timelineFeatureArray.push({yearChanged:n,newLaw:a.properties[expressed][n],feature:a})}var l=[];for(i=0;i<keyArray.length;i++){var c={year:keyArray[i],count:0};l.push(c)}console.log(l);r.selectAll(".rect").data(timelineFeatureArray).enter().append("rect").attr("class",function(e){return"rect "+e.feature.properties.postal}).attr("width",squareWidth+"px").attr("height",squareHeight+"px").attr("transform",function(e){return"translate("+t(e.yearChanged)+")"}).attr("y",function(e,t){var r;for(t=0;t<l.length;t++)l[t].year==e.yearChanged&&(r=l[t].count*(squareHeight+1),l[t].count-=1);return r}).style("fill",function(){return"#000"}).on("mouseover",highlightChart).on("mouseout",dehighlightChart),r.append("svg").attr("class","axis").attr("width","90%").attr("height","10px")}function updateChart(){}function highlight(e){var t=e.properties?e.properties:e.feature.properties[expressed];d3.selectAll("."+t.postal).style("fill","#00C6FF")}function highlightChart(e){var t=e.feature.properties;d3.selectAll("."+t.postal).style("fill","#00C6FF")}function dehighlight(e){var t=e.properties?e.properties:e.feature.properties[expressed],r=d3.selectAll("."+t.postal),o=r.select("desc").text();r.style("fill",o)}function dehighlightChart(){var e=timelineFeatureArray.feature.properties,t=d3.selectAll("."+e.postal),r=t.select("desc").text();t.style("fill",r)}var mapWidth=850,mapHeight=500,keyArray=["1973","1974","1975","1976","1977","1977","1977","1978","1979","1980","1981","1982","1983","1984","1983","1984","1985","1986","1987","1988","1989","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],Category=["gradeData","prohibitedAfter","counseling","waitingPeriod","consentData","ultrasound"],expressed,yearExpressed,colorize,scale,currentColors=[],menuWidth=200,menuHeight=420,otherMenuWidth=198,otherMenuHeight=70,menuInfoWidth=400,menuInfoHeight=100,textArray=["State grade based on abortion choice-related laws.","State laws restricting abortion services provided beyond the national law.","States with laws that subject women seeking abortion services to biased-counseling requirements.","State required waiting period (in hours) after counseling before a woman can have an abortion.","State laws restricting young women's access to abortion services by mandating parental consent and/or notice.","State laws mandating the offering of and/or requiring ultrasound services.","Crisis Pregnancy Centers are facilities that provide women with services and counseling to pregnant women, but appose abortion. CPC's are known for intimidating women about the dangers of abortion with inaccurate information.","Abortion Providers are facilites that help with family planning, reproductive health, and educate people about safe sex. They do not promote abortion, but help women in need of one"],removeCPC,removeAbortion,joinedJson,arrayOverview=["F","D","C","B","A"],arrayProhibited=["12 weeks","20 weeks","22 weeks","24 weeks","3rd trimester","Viability"],arrayCounseling=["Yes","No"],arrayWaitingPeriod=["72 hours","48 hours","24 hours","18 hours","None"],arrayConsent=["consent","notice","none"],arrayUltrasound=["Must be performed, offer to view","x","o","none"],colorArrayOverview=["#252525","#636363","#969696","#cccccc","#e6e6e6"],colorArrayProhibited=["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#e6e6e6"],colorArrayCounseling=["#252525","#e6e6e6"],colorArrayConsent=["#252525","#969696","#e6e6e6"],colorArrayUltrasound=["#252525","#636363","#969696","#e6e6e6"],currentColors=[],currentArray=[],chartHeight=200,chartWidth=100,squareWidth=20,squareHeight=20,timelineFeatureArray=[];window.onload=initialize(),$(function(){$(".nav li a").on("click",function(){var e=$(this).parent("li"),t=e.parent("ul");e.hasClass("active")||(t.find("li.active").removeClass("active"),e.addClass("active"))})});