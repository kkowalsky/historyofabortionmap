function initialize(){setMap()}function setMap(){function t(t,r,o,n,s,i){function c(t,e,r){for(var a=n.objects.states.geometries,o=0;o<e.length;o++)for(var s=e[o],i=s.adm,c=0;c<a.length;c++)if(a[c].properties.postal==i){attrObj={};for(var l in yearsArray){var d=yearsArray[l],p=s[d];attrObj[d]=p}a[c].properties[r]=attrObj;break}}colorize=colorScale(r,o),joinedJson=topojson.feature(n,n.objects.states).features;var l=[r,o],d=["ConsentData","gradeData"];for(csv in l)c(n,l[csv],d[csv]);for(var p=(e.selectAll(".states").data(joinedJson).enter().append("path").attr("class",function(t){return"states "+t.properties.postal}).attr("d",function(t){return a(t)}).style("fill",function(t){return choropleth(t,colorize)}),[]),u=0;u<s.features.length;u++){var f=s.features[u].properties.Count;p.push(Number(f))}for(var h=Math.min.apply(Math,p),v=Math.max.apply(Math,p),g=d3.scale.sqrt().domain([h,v]).range([2,15]),m=[],y=0;y<i.features.length;y++){var b=i.features[y].properties.Count;m.push(Number(b))}Math.min.apply(Math,m),Math.max.apply(Math,m);overlay(a,g,e,s,i),setChart()}var e=d3.select(".map").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","us-map"),r=d3.geo.albersUsa().scale(1e3).translate([mapWidth/2,mapHeight/2]),a=d3.geo.path().projection(r);queue().defer(d3.csv,"data/consent.csv").defer(d3.csv,"data/Grades.csv").defer(d3.json,"data/usa.topojson").defer(d3.json,"data/CPCS.geojson").defer(d3.json,"data/AbortionProviders.geojson").await(t)}function drawMenu(){}function cpcPoints(t,e,r,a){t.selectAll(".cpcLocations").data(e.features).enter().append("path").attr("class","cpcLocations").attr("d",r.pointRadius(function(t){return a(t.properties.Count)}))}function abortionPoints(t,e,r,a){t.selectAll(".abortionLocations").data(e.features).enter().append("path").attr("class","abortionLocations").attr("d",r.pointRadius(function(t){return a(t.properties.Count)}))}function overlay(t,e,r,a,o){$(".cpc-section").click(function(){d3.selectAll(".cpcLocations")[0].length>0?removeCPC=d3.selectAll(".cpcLocations").remove():cpcPoints(r,a,t,e)}),$(".abortion-section").click(function(){d3.selectAll(".abortionLocations")[0].length>0?removeAbortion=d3.selectAll(".abortionLocations").remove():abortionPoints(r,o,t,e)})}function changeAttribute(){}function colorScale(){"gradeData"===expressed?(scale=d3.scale.ordinal(),currentColors=colorArrayGrade):"consentData"===expressed&&(scale=d3.scale.ordinal(),currentColors=colorArrayConsent),scale=scale.range(currentColors)}function choropleth(t,e){var r=t.properties?t.properties[expressed]:t[expressed];return r?e(r,value2):"No data"===r?"#ccc":"#ccc"}function setChart(){var t={top:10,right:40,bottom:30,left:40},e=d3.scale.linear().domain(timelineArray).rangeRound([0,chartWidth-t.left-t.right]),r=d3.svg.axis(),a=d3.select(".graph").append("svg").attr("width",chartWidth+"%").attr("height",chartHeight+"px").attr("class","chart").append("g").attr("transform","translate("+t.left+", "+t.top+")"),o=a.selectAll(".rect").data(joinedJson).enter().append("rect").attr("class",function(t){return"rect "+t.properties.postal}).attr("width",squareWidth+"px").attr("height",squareHeight+"px");console.log(o);r.axis().scale(e).orient("bottom").tickValues(timelineArray).attr("class","timeline")}function updateChart(){}var mapWidth=850,mapHeight=600,yearsArray=["grade","Pre-1973","1973","1974","1975","1976","1977","1977","1977","1978","1979","1980","1981","1982","1983","1984","1983","1984","1985","1986","1987","1988","1989","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],Category=["gradeData","ConsentData"],expressed=Category[0],removeCPC,removeAbortion,joinedJson,colorize,scale,currentColors=[];window.onload=initialize(),colorArrayGrade=["#252525","#636363","#969696","#cccccc","#f7f7f7"],colorArrayProhibited=["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],colorArrayCounseling=["#252525","#f7f7f7"],colorArrayConsent=["#252525","#969696","#f7f7f7"],colorArrayUltrasound=["#252525","#636363","#969696","#f7f7f7"],arrayOverview=["F","D","C","B","A"],arrayProhibited=["12 weeks","20 weeks","22 weeks","24 weeks","3rd trimester","Viability"],arrayCounseling=["Yes","No"],arrayWaitingPeriod=["72 hours","48 hours","24 hours","18 hours","None"],arrayConsent=["Consent","Notice","None"],arrayUltrasound=["Must be performed, offer to view","Must be performed","Must be offered","None"];var timelineArray=["1973","1974","1975","1976","1977","1977","1977","1978","1979","1980","1981","1982","1983","1984","1983","1984","1985","1986","1987","1988","1989","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014"],chartHeight=200,chartWidth=100,squareWidth=20,squareHeight=20;$(function(){$(".nav li a").on("click",function(){var t=$(this).parent("li"),e=t.parent("ul");t.hasClass("active")||(e.find("li.active").removeClass("active"),t.addClass("active"))})});